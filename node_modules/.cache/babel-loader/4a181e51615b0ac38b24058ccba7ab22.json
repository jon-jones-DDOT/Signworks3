{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Projects\\\\Signworks3\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(checkAuth),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(authLogout),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchStartAPI);\n\n// Copyright 2019 Esri Licensed under the Apache License, Version 2.0 (the\n// \"License\"); you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n// http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law\n// or agreed to in writing, software distributed under the License is\n// distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied. See the License for the specific language\n// governing permissions and limitations under the License.​\nimport { call, put, takeLatest } from 'redux-saga/effects';\nimport { types } from '../reducers/auth';\nimport { types as configTypes } from \"../reducers/config\";\nimport { logout } from '../../services/api';\nimport { getGroups } from \"../../utils/JSAPI\"; // WORKER //\n\nfunction checkAuth(action) {\n  var isEditor, isViewer, authObj, edit, view;\n  return _regeneratorRuntime.wrap(function checkAuth$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          isEditor = false;\n          isViewer = false;\n          _context.next = 5;\n          return call(window.authManager.login, action.payload.portalUrl);\n\n        case 5:\n          authObj = _context.sent;\n          _context.next = 8;\n          return call(getGroups, [authObj.portal, \"Signworks Editors\"]);\n\n        case 8:\n          edit = _context.sent;\n\n          if (!(edit.results.length > 0)) {\n            _context.next = 14;\n            break;\n          }\n\n          isEditor = true;\n          isViewer = true;\n          _context.next = 20;\n          break;\n\n        case 14:\n          console.log('not reached, correct?');\n          _context.next = 17;\n          return call(getGroups, [authObj.portal, \"Signworks Viewers\"]);\n\n        case 17:\n          view = _context.sent;\n          isEditor = false;\n          isViewer = true;\n\n        case 20:\n          if (!authObj) {\n            _context.next = 27;\n            break;\n          }\n\n          _context.next = 23;\n          return put({\n            type: types.AUTH_SUCCESS,\n            payload: {\n              user: authObj,\n              isEditor: isEditor,\n              isViewer: isViewer\n            }\n          });\n\n        case 23:\n          _context.next = 25;\n          return put({\n            type: configTypes.SET_LAYERS,\n            payload: {\n              mode: \"dev\"\n            }\n          });\n\n        case 25:\n          _context.next = 29;\n          break;\n\n        case 27:\n          _context.next = 29;\n          return put({\n            type: types.AUTH_FAIL\n          });\n\n        case 29:\n          _context.next = 36;\n          break;\n\n        case 31:\n          _context.prev = 31;\n          _context.t0 = _context[\"catch\"](0);\n          _context.next = 35;\n          return put({\n            type: types.AUTH_FAIL\n          });\n\n        case 35:\n          console.error('SAGA ERROR: auth/checkAuth, ', _context.t0);\n\n        case 36:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 31]]);\n}\n\nfunction authLogout(action) {\n  return _regeneratorRuntime.wrap(function authLogout$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return call(window.authManager.logout);\n\n        case 3:\n          _context2.next = 5;\n          return call(logout, action.payload.portalUrl);\n\n        case 5:\n          window.location.reload();\n          _context2.next = 11;\n          break;\n\n        case 8:\n          _context2.prev = 8;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.error('SAGA ERROR: auth/logout, ', _context2.t0);\n\n        case 11:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[0, 8]]);\n} // WATCHER //\n\n\nexport function watchStartAPI() {\n  return _regeneratorRuntime.wrap(function watchStartAPI$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return takeLatest(types.AUTH_CHECK, checkAuth);\n\n        case 2:\n          _context3.next = 4;\n          return takeLatest(types.LOGOUT, authLogout);\n\n        case 4:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}","map":{"version":3,"sources":["C:\\Projects\\Signworks3\\src\\redux\\sagas\\_auth.js"],"names":["checkAuth","authLogout","watchStartAPI","call","put","takeLatest","types","configTypes","logout","getGroups","action","isEditor","isViewer","window","authManager","login","payload","portalUrl","authObj","portal","edit","results","length","console","log","view","type","AUTH_SUCCESS","user","SET_LAYERS","mode","AUTH_FAIL","error","location","reload","AUTH_CHECK","LOGOUT"],"mappings":"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","sourcesContent":["// Copyright 2019 Esri Licensed under the Apache License, Version 2.0 (the\r\n// \"License\"); you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n// http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law\r\n// or agreed to in writing, software distributed under the License is\r\n// distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n// KIND, either express or implied. See the License for the specific language\r\n// governing permissions and limitations under the License.​\r\n\r\nimport {call, put, takeLatest} from 'redux-saga/effects';\r\nimport {types} from '../reducers/auth';\r\nimport {types as configTypes} from \"../reducers/config\"\r\nimport {logout} from '../../services/api';\r\nimport {getGroups} from \"../../utils/JSAPI\"\r\n\r\n// WORKER //\r\nfunction * checkAuth(action) {\r\n    try {\r\n        let isEditor = false;\r\n        let isViewer = false;\r\n        const authObj = yield call(window.authManager.login, action.payload.portalUrl);\r\n        const edit = yield call(getGroups, [authObj.portal, \"Signworks Editors\"]);\r\n        if (edit.results.length > 0) {\r\n            isEditor = true;\r\n            isViewer = true;\r\n\r\n        } else {\r\n            console.log('not reached, correct?')\r\n            const view = yield call(getGroups, [authObj.portal, \"Signworks Viewers\"]);\r\n            isEditor = false;\r\n            isViewer = true;\r\n        }\r\n\r\n        // Check if the authObj is undefined\r\n        if (authObj) {\r\n            yield put({type: types.AUTH_SUCCESS, payload:{user:authObj, isEditor, isViewer} });\r\n            yield put({type:configTypes.SET_LAYERS, payload:{mode:\"dev\"}})\r\n        } else {\r\n            // putting a fail call here just means that we didn't need to login\r\n            yield put({type: types.AUTH_FAIL});\r\n        }\r\n\r\n    } catch (e) {\r\n        yield put({type: types.AUTH_FAIL});\r\n        console.error('SAGA ERROR: auth/checkAuth, ', e);\r\n    }\r\n}\r\n\r\nfunction * authLogout(action) {\r\n    try {\r\n\r\n        yield call(window.authManager.logout);\r\n        yield call(logout, action.payload.portalUrl);\r\n        window\r\n            .location\r\n            .reload();\r\n    } catch (e) {\r\n        console.error('SAGA ERROR: auth/logout, ', e);\r\n    }\r\n}\r\n\r\n// WATCHER //\r\nexport function * watchStartAPI() {\r\n    yield takeLatest(types.AUTH_CHECK, checkAuth);\r\n    yield takeLatest(types.LOGOUT, authLogout);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}