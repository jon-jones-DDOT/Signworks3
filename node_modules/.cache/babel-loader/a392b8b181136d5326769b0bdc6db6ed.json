{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Projects\\\\Signworks3\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\n\nvar _marked =\n/*#__PURE__*/\n_regeneratorRuntime.mark(checkAuth),\n    _marked2 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(authLogout),\n    _marked3 =\n/*#__PURE__*/\n_regeneratorRuntime.mark(watchStartAPI);\n\n// Copyright 2019 Esri\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//     http://www.apache.org/licenses/LICENSE-2.0\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.​\nimport { call, put, takeLatest } from 'redux-saga/effects';\nimport { types } from '../reducers/auth';\nimport { logout } from '../../services/api';\nimport { getGroups } from '../../utils/JSAPI'; // WORKER //\n\nfunction checkAuth(action) {\n  var isEditor, isViewer, authObj, edit, view;\n  return _regeneratorRuntime.wrap(function checkAuth$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          isEditor = false;\n          isViewer = false;\n          _context.next = 5;\n          return call(window.authManager.login, action.payload.portalUrl);\n\n        case 5:\n          authObj = _context.sent;\n          _context.next = 8;\n          return call(getGroups, [authObj.portal, \"Signworks 2Editors\"]);\n\n        case 8:\n          edit = _context.sent;\n\n          if (!(edit.results.length > 0)) {\n            _context.next = 14;\n            break;\n          }\n\n          isEditor = true;\n          isViewer = true;\n          _context.next = 19;\n          break;\n\n        case 14:\n          _context.next = 16;\n          return call(getGroups, [authObj.portal, \"Signworks Viewers\"]);\n\n        case 16:\n          view = _context.sent;\n          isEditor = false;\n          isViewer = true;\n\n        case 19:\n          if (!authObj) {\n            _context.next = 24;\n            break;\n          }\n\n          _context.next = 22;\n          return put({\n            type: types.AUTH_SUCCESS,\n            payload: authObj\n          });\n\n        case 22:\n          _context.next = 26;\n          break;\n\n        case 24:\n          _context.next = 26;\n          return put({\n            type: types.AUTH_FAIL\n          });\n\n        case 26:\n          _context.next = 33;\n          break;\n\n        case 28:\n          _context.prev = 28;\n          _context.t0 = _context[\"catch\"](0);\n          _context.next = 32;\n          return put({\n            type: types.AUTH_FAIL\n          });\n\n        case 32:\n          console.error('SAGA ERROR: auth/checkAuth, ', _context.t0);\n\n        case 33:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _marked, null, [[0, 28]]);\n}\n\nfunction authLogout(action) {\n  return _regeneratorRuntime.wrap(function authLogout$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return call(window.authManager.logout);\n\n        case 3:\n          _context2.next = 5;\n          return call(logout, action.payload.portalUrl);\n\n        case 5:\n          window.location.reload();\n          _context2.next = 11;\n          break;\n\n        case 8:\n          _context2.prev = 8;\n          _context2.t0 = _context2[\"catch\"](0);\n          console.error('SAGA ERROR: auth/logout, ', _context2.t0);\n\n        case 11:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _marked2, null, [[0, 8]]);\n} // WATCHER //\n\n\nexport function watchStartAPI() {\n  return _regeneratorRuntime.wrap(function watchStartAPI$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return takeLatest(types.AUTH_CHECK, checkAuth);\n\n        case 2:\n          _context3.next = 4;\n          return takeLatest(types.LOGOUT, authLogout);\n\n        case 4:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _marked3);\n}","map":{"version":3,"sources":["C:\\Projects\\Signworks3\\src\\redux\\sagas\\_auth.js"],"names":["checkAuth","authLogout","watchStartAPI","call","put","takeLatest","types","logout","getGroups","action","isEditor","isViewer","window","authManager","login","payload","portalUrl","authObj","portal","edit","results","length","view","type","AUTH_SUCCESS","AUTH_FAIL","console","error","location","reload","AUTH_CHECK","LOGOUT"],"mappings":";;;;yBAiBUA,S;;;yBAiCAC,U;;;yBAYOC,a;;AA9DjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SAASC,IAAT,EAAeC,GAAf,EAAoBC,UAApB,QAAsC,oBAAtC;AACA,SAASC,KAAT,QAAsB,kBAAtB;AACA,SAASC,MAAT,QAAuB,oBAAvB;AACA,SAAQC,SAAR,QAAwB,mBAAxB,C,CAEA;;AACA,SAAUR,SAAV,CAAoBS,MAApB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEQC,UAAAA,QAFR,GAEmB,KAFnB;AAGQC,UAAAA,QAHR,GAGmB,KAHnB;AAAA;AAIoB,iBAAMR,IAAI,CAACS,MAAM,CAACC,WAAP,CAAmBC,KAApB,EAA2BL,MAAM,CAACM,OAAP,CAAeC,SAA1C,CAAV;;AAJpB;AAIUC,UAAAA,OAJV;AAAA;AAKiB,iBAAMd,IAAI,CAACK,SAAD,EAAW,CAACS,OAAO,CAACC,MAAT,EAAgB,oBAAhB,CAAX,CAAV;;AALjB;AAKUC,UAAAA,IALV;;AAAA,gBAMQA,IAAI,CAACC,OAAL,CAAaC,MAAb,GAAsB,CAN9B;AAAA;AAAA;AAAA;;AAOMX,UAAAA,QAAQ,GAAE,IAAV;AACAC,UAAAA,QAAQ,GAAG,IAAX;AARN;AAAA;;AAAA;AAAA;AAWmB,iBAAMR,IAAI,CAACK,SAAD,EAAW,CAACS,OAAO,CAACC,MAAT,EAAgB,mBAAhB,CAAX,CAAV;;AAXnB;AAWYI,UAAAA,IAXZ;AAYMZ,UAAAA,QAAQ,GAAG,KAAX;AACDC,UAAAA,QAAQ,GAAG,IAAX;;AAbL;AAAA,eAiBQM,OAjBR;AAAA;AAAA;AAAA;;AAAA;AAkBM,iBAAMb,GAAG,CAAC;AACNmB,YAAAA,IAAI,EAAEjB,KAAK,CAACkB,YADN;AAENT,YAAAA,OAAO,EAAEE;AAFH,WAAD,CAAT;;AAlBN;AAAA;AAAA;;AAAA;AAAA;AAwBM,iBAAMb,GAAG,CAAE;AAACmB,YAAAA,IAAI,EAAEjB,KAAK,CAACmB;AAAb,WAAF,CAAT;;AAxBN;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AA4BI,iBAAMrB,GAAG,CAAE;AAACmB,YAAAA,IAAI,EAAEjB,KAAK,CAACmB;AAAb,WAAF,CAAT;;AA5BJ;AA6BIC,UAAAA,OAAO,CAACC,KAAR,CAAc,8BAAd;;AA7BJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAiCA,SAAU1B,UAAV,CAAqBQ,MAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGI,iBAAMN,IAAI,CAACS,MAAM,CAACC,WAAP,CAAmBN,MAApB,CAAV;;AAHJ;AAAA;AAII,iBAAMJ,IAAI,CAACI,MAAD,EAASE,MAAM,CAACM,OAAP,CAAeC,SAAxB,CAAV;;AAJJ;AAKIJ,UAAAA,MAAM,CAACgB,QAAP,CAAgBC,MAAhB;AALJ;AAAA;;AAAA;AAAA;AAAA;AAOIH,UAAAA,OAAO,CAACC,KAAR,CAAc,2BAAd;;AAPJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,C,CAWA;;;AACA,OAAO,SAAUzB,aAAV;AAAA;AAAA;AAAA;AAAA;AAAA;AACL,iBAAMG,UAAU,CAACC,KAAK,CAACwB,UAAP,EAAmB9B,SAAnB,CAAhB;;AADK;AAAA;AAEL,iBAAMK,UAAU,CAACC,KAAK,CAACyB,MAAP,EAAe9B,UAAf,CAAhB;;AAFK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA","sourcesContent":["// Copyright 2019 Esri\r\n// Licensed under the Apache License, Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//     http://www.apache.org/licenses/LICENSE-2.0\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.​\r\n\r\nimport { call, put, takeLatest } from 'redux-saga/effects';\r\nimport { types } from '../reducers/auth';\r\nimport { logout } from '../../services/api';\r\nimport {getGroups} from '../../utils/JSAPI'\r\n\r\n// WORKER //\r\nfunction* checkAuth(action) {\r\n  try {\r\n    let isEditor = false;\r\n    let isViewer = false;\r\n    const authObj = yield call(window.authManager.login, action.payload.portalUrl);\r\n    const edit = yield call(getGroups,[authObj.portal,\"Signworks 2Editors\"])\r\n    if (edit.results.length > 0){\r\n      isEditor= true;\r\n      isViewer = true;\r\n    }\r\n    else{\r\n      const view = yield call(getGroups,[authObj.portal,\"Signworks Viewers\"]);\r\n      isEditor = false;\r\n     isViewer = true;\r\n    }\r\n    \r\n    // Check if the authObj is undefined\r\n    if (authObj) {\r\n      yield put({\r\n          type: types.AUTH_SUCCESS,\r\n          payload: authObj\r\n      });\r\n    } else {\r\n      // putting a fail call here just means that we didn't need to login\r\n      yield put( {type: types.AUTH_FAIL} );\r\n    }\r\n\r\n  } catch(e) {\r\n    yield put( {type: types.AUTH_FAIL} );\r\n    console.error('SAGA ERROR: auth/checkAuth, ', e);\r\n  }\r\n}\r\n\r\nfunction* authLogout(action) {\r\n  try {\r\n   \r\n    yield call(window.authManager.logout);\r\n    yield call(logout, action.payload.portalUrl);\r\n    window.location.reload();\r\n  } catch(e) {\r\n    console.error('SAGA ERROR: auth/logout, ', e);\r\n  }\r\n}\r\n\r\n// WATCHER //\r\nexport function* watchStartAPI() {\r\n  yield takeLatest(types.AUTH_CHECK, checkAuth);\r\n  yield takeLatest(types.LOGOUT, authLogout);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}